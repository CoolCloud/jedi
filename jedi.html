<!doctype html>
<script src="lib/Tabish/type.js"></script>
<script src="lib/Tabish/iterator.js"></script>
<script src="lib/Tabish/matcher.js"></script>
<script src="lib/Tabish/tabish.js"></script>
<script src="jedi.js"></script>
<style>
textarea {
	font-family: Consolas, verdana, monospace;
}
textarea {
	display: block;
	min-width: 30em;
	min-height: 10em;
	-webkit-tab-size: 4; 
	-moz-tab-size: 4;
	-o-tab-size: 4;
}
div {
	float: left
	
}
#output {
	width: 600px;
	height: 380px;
	overflow: scroll;
}
</style>

<div>
<textarea id="test6" rows="25" cols="80">
html
	head
		title
			'Test
		style
			body {
				font: small 'Microsoft Yahei', sans-serif;
			}
			section {
				border: 1px solid;
				margin: 1em;
				min-height: 10em;
			}
	body
		header
			h1
				'Test: {1}{'+'}{1}={1+1}
			:if true
				'Hello world!
			:if false
				'Oops!
				
			:for i in [1,2,3]
				p
					'Hello!
			nav
				ul
					li
						a
							@href="/"
							'home
					li
						a
							@href="#a"
							'Part A
					li
						a
							@href="#b"
							'Part B
					li
						a
							@href="#c"
							'Part C
		section#a
			h1
				'A
			p
			p
			p
		section#b
			h1
				'B
			p
			p
			p
		section#c
			h1
				'C
			p
			p
			p
</textarea>
<input type="button" value="test" onclick="test('test6')">
</div>

<div>
<iframe id="output"></iframe>
</div>

<script>
function test(id) {
	try {
		var runtime = new jedi.JSRuntime()
		var source = document.getElementById(id).value
		var template = runtime.eval(jedi.compileToJS(source))
		var html = ''
		var doc = document.getElementById('output').contentDocument
		doc.open()
		template.echo = function(s){
			console.log(s)
			doc.write(s)
		}
		template.call(null, {name: 'hax'})
	} catch(e) {
		console.error(e.message, e)
	}
}
</script>
